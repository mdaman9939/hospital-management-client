import{q as $,r as h,j as e}from"./index-C8M8d5TP.js";import{C as m,a as r}from"./CRow-DwbOyR1O.js";import{C as f,a as y}from"./CCardBody-BC-1MHGB.js";import{C as w}from"./CCardHeader-Cy4Bd0Ol.js";import{C as H}from"./CForm-w6XIb02x.js";import{C as l}from"./CFormLabel-Dc_uzIQC.js";import{C as c}from"./CFormInput-Bd3bcSFW.js";import{C as A}from"./CFormSelect-DPn45vPc.js";import{C as v}from"./CFormTextarea-CI9dEni-.js";import{a as N}from"./index.esm-D35apfu2.js";import{C as T,a as k,b as S,c as s,d as I,e as o}from"./CTable-DhOiOdMA.js";import"./CFormControlWrapper-CObUvOP_.js";import"./CFormControlValidation-1FHZm8X5.js";const K=()=>{const j=$();h.useEffect(()=>{localStorage.getItem("token")||j("/login")},[j]);const p=()=>{const t=new Date,n=t.getFullYear(),d=(t.getMonth()+1).toString().padStart(2,"0"),x=t.getDate().toString().padStart(2,"0"),G=t.getHours().toString().padStart(2,"0");return`${n}-${d}-${x}T${G}:00`},[a,g]=h.useState({patientName:"",patientAge:"",patientGender:"",contactInfo:"",admissionDate:p(),address:"",ward:"",guardianContact:"",medicalHistory:""}),[u,D]=h.useState([]),i=t=>{const{id:n,value:d}=t.target;g(x=>({...x,[n]:d}))},C=async()=>{try{const t=localStorage.getItem("token");if(console.log("Token from localStorage:",t),!t){console.error("No token found.");return}const n=await fetch("http://localhost:1000/api/patient",{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){console.error("Authentication error:",n.statusText);return}const d=await n.json();d.length>0?D(d.reverse()):console.log("No patients found for this user.")}catch(t){console.error("Error fetching patients:",t)}};h.useEffect(()=>{C()},[]);const b=async t=>{t.preventDefault();const n=localStorage.getItem("token");if(!n){alert("No token found!");return}try{(await fetch("http://localhost:1000/api/register",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(a)})).ok?(C(),g({patientName:"",patientAge:"",patientGender:"",contactInfo:"",admissionDate:p(),address:"",ward:"",guardianContact:"",medicalHistory:""})):console.error("Failed to register patient.")}catch(d){console.error("Error registering patient:",d)}},F=t=>{const n=window.open("","","height=600,width=800");n.document.write("<html><head><title>Patient Admission</title></head><body>"),n.document.write(`<h1>Admission Details for ${t.patientName}</h1>`),n.document.write(`<p><strong>Age:</strong> ${t.patientAge}</p>`),n.document.write(`<p><strong>Gender:</strong> ${t.patientGender}</p>`),n.document.write(`<p><strong>Contact:</strong> ${t.contactInfo}</p>`),n.document.write(`<p><strong>Admission Date:</strong> ${t.admissionDate}</p>`),n.document.write(`<p><strong>Address:</strong> ${t.address}</p>`),n.document.write(`<p><strong>Ward:</strong> ${t.ward}</p>`),n.document.write(`<p><strong>Guardian Contact:</strong> ${t.guardianContact}</p>`),n.document.write(`<p><strong>Medical History:</strong> ${t.medicalHistory}</p>`),n.document.write("</body></html>"),n.document.close(),n.print()};return e.jsx(m,{children:e.jsxs(r,{xs:12,children:[e.jsxs(f,{className:"mb-4",children:[e.jsx(w,{children:e.jsx("strong",{children:"Patient Registration and Admission"})}),e.jsx(y,{children:e.jsxs(H,{onSubmit:b,children:[e.jsxs(m,{children:[e.jsxs(r,{md:3,children:[e.jsx(l,{htmlFor:"patientName",children:"Patient Name"}),e.jsx(c,{type:"text",id:"patientName",placeholder:"Full name",value:a.patientName,onChange:i})]}),e.jsxs(r,{md:2,children:[e.jsx(l,{htmlFor:"patientAge",children:"Age"}),e.jsx(c,{type:"number",id:"patientAge",placeholder:"Age",value:a.patientAge,onChange:i})]}),e.jsxs(r,{md:2,children:[e.jsx(l,{htmlFor:"patientGender",children:"Gender"}),e.jsxs(A,{id:"patientGender",value:a.patientGender,onChange:i,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs(r,{md:3,children:[e.jsx(l,{htmlFor:"contactInfo",children:"Contact Number"}),e.jsx(c,{type:"tel",id:"contactInfo",placeholder:"Contact number",value:a.contactInfo,onChange:i})]}),e.jsxs(r,{md:2,children:[e.jsx(l,{htmlFor:"admissionDate",children:"Admission Date"}),e.jsx(c,{type:"datetime-local",id:"admissionDate",value:a.admissionDate,onChange:i})]})]}),e.jsxs(m,{className:"mt-3",children:[e.jsxs(r,{md:5,children:[e.jsx(l,{htmlFor:"address",children:"Address"}),e.jsx(v,{id:"address",rows:"1",placeholder:"Address",value:a.address,onChange:i})]}),e.jsxs(r,{md:3,children:[e.jsx(l,{htmlFor:"ward",children:"Ward/Room"}),e.jsxs(A,{id:"ward",value:a.ward,onChange:i,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"general",children:"General Ward"}),e.jsx("option",{value:"private",children:"Private Room"}),e.jsx("option",{value:"icu",children:"ICU"})]})]}),e.jsxs(r,{md:4,children:[e.jsx(l,{htmlFor:"guardianContact",children:"Guardian Contact"}),e.jsx(c,{type:"text",id:"guardianContact",placeholder:"Guardian's contact",value:a.guardianContact,onChange:i})]})]}),e.jsxs(m,{className:"mt-3",children:[e.jsxs(r,{md:10,children:[e.jsx(l,{htmlFor:"medicalHistory",children:"Medical History"}),e.jsx(v,{id:"medicalHistory",rows:"2",placeholder:"Relevant medical history",value:a.medicalHistory,onChange:i})]}),e.jsx(r,{md:2,className:"d-flex align-items-end",children:e.jsx(N,{color:"primary",type:"submit",className:"w-100",children:"Submit"})})]})]})})]}),e.jsxs(f,{children:[e.jsx(w,{children:e.jsx("strong",{children:"Patient List"})}),e.jsx(y,{children:u.length>0?e.jsxs(T,{children:[e.jsx(k,{children:e.jsxs(S,{children:[e.jsx(s,{children:"#"}),e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Age"}),e.jsx(s,{children:"Gender"}),e.jsx(s,{children:"Contact"}),e.jsx(s,{children:"Admission Date"}),e.jsx(s,{children:"Address"}),e.jsx(s,{children:"Ward"}),e.jsx(s,{children:"Guardian Contact"}),e.jsx(s,{children:"Medical History"}),e.jsx(s,{children:"Action"})]})}),e.jsx(I,{children:u.map((t,n)=>e.jsxs(S,{children:[e.jsx(o,{children:n+1}),e.jsx(o,{children:t.patientName||""}),e.jsx(o,{children:t.patientAge||""}),e.jsx(o,{children:t.patientGender||""}),e.jsx(o,{children:t.contactInfo||""}),e.jsx(o,{children:t.admissionDate?new Date(t.admissionDate).toLocaleString():""}),e.jsx(o,{children:t.address||""}),e.jsx(o,{children:t.ward||""}),e.jsx(o,{children:t.guardianContact||""}),e.jsx(o,{children:t.medicalHistory||""}),e.jsx(o,{children:e.jsx(N,{color:"secondary",onClick:()=>F(t),children:"Print"})})]},t._id))})]}):e.jsx("p",{children:"No patients found."})})]})]})})};export{K as default};
