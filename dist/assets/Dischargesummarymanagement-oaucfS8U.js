import{q as J,r as a,j as e}from"./index-C8M8d5TP.js";import{C as d,a as n}from"./CRow-DwbOyR1O.js";import{C as q,a as W}from"./CCardBody-BC-1MHGB.js";import{C as _}from"./CCardHeader-Cy4Bd0Ol.js";import{C as K}from"./CForm-w6XIb02x.js";import{C as c}from"./CFormLabel-Dc_uzIQC.js";import{C as j}from"./CFormInput-Bd3bcSFW.js";import{C as m}from"./CFormTextarea-CI9dEni-.js";import{a as U}from"./index.esm-D35apfu2.js";import{C as Q,a as V,b as $,c as r,d as X,e as i}from"./CTable-DhOiOdMA.js";import"./CFormControlWrapper-CObUvOP_.js";import"./CFormControlValidation-1FHZm8X5.js";const de=()=>{const x=J();a.useEffect(()=>{localStorage.getItem("token")||x("/login")},[x]);const[u,f]=a.useState(""),[C,p]=a.useState(""),[D,S]=a.useState(""),[w,N]=a.useState(""),[v,y]=a.useState(""),[T,b]=a.useState(""),[F,I]=a.useState(""),[E,k]=a.useState(""),[A,B]=a.useState([]),[g,P]=a.useState([]),[l,M]=a.useState(null),[O,z]=a.useState(!0);a.useEffect(()=>{(()=>{const s=localStorage.getItem("token");if(s){const o=JSON.parse(atob(s.split(".")[1]));M(o.id)}})()},[]),a.useEffect(()=>{l&&(async()=>{const s=localStorage.getItem("token");try{const h=await(await fetch("http://localhost:1000/api/patient",{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();B(h),z(!1)}catch(o){console.error("Error fetching patient data:",o)}})()},[l]);const G=t=>{const s=t.target.value;if(f(s),O)return;const o=A.find(h=>h.patientName.toLowerCase()===s.toLowerCase());p(o?o.admissionDate.split("T")[0]:"")};a.useEffect(()=>{S(new Date().toISOString().split("T")[0])},[]);const L=async t=>{t.preventDefault();try{const s=await fetch("http://localhost:1000/api/summary",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({patientName:u,admissionDate:C,dischargeDate:D,diagnosis:w,treatments:v,medications:T,followUp:F,notes:E,userId:l})});if(s.ok){const o=await s.json();P([...g,o])}else{const o=await s.json();alert(o.message||"Failed to save discharge summary.")}}catch(s){console.error("Error saving the discharge summary:",s),alert("Error saving the discharge summary.")}f(""),p(""),S(""),N(""),y(""),b(""),I(""),k("")};a.useEffect(()=>{l&&H()},[l]);const H=async()=>{try{const o=(await(await fetch("http://localhost:1000/api/summary",{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json()).filter(h=>h.userId===l);P(o)}catch(t){console.error("Error fetching discharge summaries:",t)}},R=t=>{const s=window.open("","_blank");s.document.write(`
      <html>
        <head>
          <title>Discharge Summary</title>
        </head>
        <body>
          <h1>Discharge Summary</h1>
          <p><strong>Patient Name:</strong> ${t.patientName}</p>
          <p><strong>Admission Date:</strong> ${t.admissionDate}</p>
          <p><strong>Discharge Date:</strong> ${t.dischargeDate}</p>
          <p><strong>Diagnosis:</strong> ${t.diagnosis}</p>
          <p><strong>Treatments Given:</strong> ${t.treatments}</p>
          <p><strong>Medications:</strong> ${t.medications}</p>
          <p><strong>Follow-Up Instructions:</strong> ${t.followUp}</p>
          <p><strong>Notes:</strong> ${t.notes}</p>
        </body>
      </html>
    `),s.document.close(),s.print()};return e.jsx(d,{children:e.jsx(n,{xs:12,children:e.jsxs(q,{className:"mb-4",children:[e.jsx(_,{children:e.jsx("strong",{children:"Discharge Summary Management"})}),e.jsxs(W,{children:[e.jsxs(K,{onSubmit:L,children:[e.jsxs(d,{children:[e.jsxs(n,{md:4,children:[e.jsx(c,{htmlFor:"patientName",children:"Patient Name"}),e.jsx(j,{type:"text",id:"patientName",placeholder:"Full name",value:u,onChange:G})]}),e.jsxs(n,{md:4,children:[e.jsx(c,{htmlFor:"admissionDate",children:"Admission Date"}),e.jsx(j,{type:"date",id:"admissionDate",value:C,readOnly:!0})]}),e.jsxs(n,{md:4,children:[e.jsx(c,{htmlFor:"dischargeDate",children:"Discharge Date"}),e.jsx(j,{type:"date",id:"dischargeDate",value:D,readOnly:!0})]})]}),e.jsxs(d,{className:"mt-3",children:[e.jsxs(n,{md:6,children:[e.jsx(c,{htmlFor:"diagnosis",children:"Diagnosis"}),e.jsx(m,{id:"diagnosis",rows:"2",placeholder:"Diagnosis details",value:w,onChange:t=>N(t.target.value)})]}),e.jsxs(n,{md:6,children:[e.jsx(c,{htmlFor:"treatments",children:"Treatments Given"}),e.jsx(m,{id:"treatments",rows:"2",placeholder:"Treatments provided",value:v,onChange:t=>y(t.target.value)})]})]}),e.jsxs(d,{className:"mt-3",children:[e.jsxs(n,{md:6,children:[e.jsx(c,{htmlFor:"medications",children:"Medications"}),e.jsx(m,{id:"medications",rows:"2",placeholder:"Prescribed medications",value:T,onChange:t=>b(t.target.value)})]}),e.jsxs(n,{md:6,children:[e.jsx(c,{htmlFor:"followUp",children:"Follow-up Instructions"}),e.jsx(m,{id:"followUp",rows:"2",placeholder:"Instructions for follow-up",value:F,onChange:t=>I(t.target.value)})]})]}),e.jsx(d,{className:"mt-3",children:e.jsxs(n,{md:12,children:[e.jsx(c,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(m,{id:"notes",rows:"3",placeholder:"Any additional information",value:E,onChange:t=>k(t.target.value)})]})}),e.jsx(d,{className:"mt-4",children:e.jsx(n,{md:12,className:"text-center",children:e.jsx(U,{color:"primary",type:"submit",className:"w-25",children:"Save Summary"})})})]}),g.length>0&&e.jsxs(Q,{className:"mt-4",bordered:!0,children:[e.jsx(V,{children:e.jsxs($,{children:[e.jsx(r,{children:"Patient Name"}),e.jsx(r,{children:"Admission Date"}),e.jsx(r,{children:"Discharge Date"}),e.jsx(r,{children:"Diagnosis"}),e.jsx(r,{children:"Treatments"}),e.jsx(r,{children:"Medications"}),e.jsx(r,{children:"Follow-Up"}),e.jsx(r,{children:"Notes"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(X,{children:g.map((t,s)=>e.jsxs($,{children:[e.jsx(i,{children:t.patientName}),e.jsx(i,{children:t.admissionDate}),e.jsx(i,{children:t.dischargeDate}),e.jsx(i,{children:t.diagnosis}),e.jsx(i,{children:t.treatments}),e.jsx(i,{children:t.medications}),e.jsx(i,{children:t.followUp}),e.jsx(i,{children:t.notes}),e.jsx(i,{children:e.jsx(U,{color:"info",size:"sm",onClick:()=>R(t),children:"Print"})})]},s))})]})]})]})})})};export{de as default};
